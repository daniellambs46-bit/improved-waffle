{
  "name": "agrihelp-server",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mysql2": "^3.6.0",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "body-parser": "^1.20.2"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
```

### ðŸ“„ `server/database.js`
```javascript
const mysql = require('mysql2/promise');

const pool = mysql.createPool({
  host: process.env.DB_HOST || 'localhost',
  user: process.env.DB_USER || 'root',
  password: process.env.DB_PASSWORD || '',
  database: process.env.DB_NAME || 'agrihelp_db',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});

module.exports = pool;
```

### ðŸ“„ `server/server.js`
```javascript
const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');
const db = require('./database');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(cors());
app.use(bodyParser.json());
app.use(express.static('../client'));

// Helper function - Bot replies
function getBotReply(message) {
  message = message.toLowerCase();
  
  // Greetings
  if (message.includes('hello') || message.includes('hi') || message.includes('hey')) {
    return 'Hi there! ðŸ‘‹ How is your farm doing today? I can help with crop diseases, pests, fertilizers, and farming tips.';
  }
  
  // Leaf problems
  if (message.includes('yellow leaves') || message.includes('yellowing')) {
    return 'Yellow leaves can indicate: 1) Nitrogen deficiency - add compost or urea fertilizer ðŸŒ± 2) Overwatering - check soil drainage 3) Iron deficiency - apply iron chelate. Which crop are you growing?';
  }
  if (message.includes('brown leaves') || message.includes('browning')) {
    return 'Brown leaves often mean: 1) Underwatering or drought stress ðŸ’§ 2) Potassium deficiency - apply potash 3) Fungal disease - use fungicide. Check soil moisture first!';
  }
  if (message.includes('spots on leaves') || message.includes('leaf spots')) {
    return 'Leaf spots are usually fungal diseases ðŸ„. Remove affected leaves, improve air circulation, and spray with copper-based fungicide or neem oil every 7-10 days.';
  }
  
  // Pests
  if (message.includes('pest') || message.includes('insect') || message.includes('bug')) {
    return 'Common pests include aphids, caterpillars, and beetles ðŸ›. Try: 1) Neem oil spray 2) Soap water solution 3) Introduce beneficial insects like ladybugs. What pest do you see?';
  }
  if (message.includes('aphid') || message.includes('greenfly')) {
    return 'Aphids suck plant sap! ðŸ› Spray with: 1) Neem oil solution 2) Dish soap + water (1 tsp per liter) 3) Plant marigolds nearby to repel them naturally.';
  }
  
  // Fertilizers
  if (message.includes('fertilizer') || message.includes('fertiliser')) {
    return 'For healthy crops use NPK fertilizer: N (Nitrogen) for leaves ðŸŒ¿, P (Phosphorus) for roots & flowers ðŸŒ¸, K (Potassium) for fruits ðŸ…. Organic options: compost, manure, bone meal.';
  }
  
  // Watering
  if (message.includes('water') || message.includes('irrigation')) {
    return 'Watering tips: ðŸ’§ 1) Water early morning or evening 2) Deep watering better than frequent light watering 3) Check soil 2 inches deep - if dry, water 4) Mulch to retain moisture.';
  }
  
  // Crops
  if (message.includes('tomato')) {
    return 'Tomato tips: ðŸ… 1) Full sun (6-8 hours) 2) Water regularly, avoid wetting leaves 3) Stake or cage plants 4) Feed with balanced fertilizer 5) Watch for blight - use fungicide if needed.';
  }
  if (message.includes('maize') || message.includes('corn')) {
    return 'Maize farming: ðŸŒ½ 1) Plant after last frost 2) Space 12 inches apart 3) Apply nitrogen fertilizer at knee-high stage 4) Water deeply weekly 5) Watch for fall armyworm - use pesticide.';
  }
  if (message.includes('bean') || message.includes('beans')) {
    return 'Bean growing: ðŸ«˜ 1) Plant in warm soil 2) No heavy fertilizer needed (they fix nitrogen!) 3) Water at base 4) Harvest regularly for more production 5) Rotate crops yearly.';
  }
  
  // Weather
  if (message.includes('weather') || message.includes('rain')) {
    return 'Weather planning: â˜€ï¸ðŸŒ§ï¸ 1) Mulch during dry season 2) Plant drought-resistant varieties 3) Use rain water harvesting 4) Provide shade during extreme heat 5) Check local weather forecasts.';
  }
  
  // Default
  return 'I can help with: ðŸŒ¾ Crop diseases, pest control, fertilizers, watering, soil health, planting tips. Ask me about specific crops (tomato, maize, beans) or problems you\'re facing!';
}

// API Routes

// 1. Create or get user
app.post('/api/users', async (req, res) => {
  try {
    const { phone_number, name, location } = req.body;
    
    // Check if user exists
    const [existing] = await db.query(
      'SELECT * FROM users WHERE phone_number = ?',
      [phone_number]
    );
    
    if (existing.length > 0) {
      return res.json(existing[0]);
    }
    
    // Create new user
    const [result] = await db.query(
      'INSERT INTO users (phone_number, name, location) VALUES (?, ?, ?)',
      [phone_number, name || 'Farmer', location || '']
    );
    
    const [newUser] = await db.query(
      'SELECT * FROM users WHERE id = ?',
      [result.insertId]
    );
    
    res.json(newUser[0]);
  } catch (error) {
    console.error('Error creating user:', error);
    res.status(500).json({ error: 'Failed to create user' });
  }
});

// 2. Send message and get bot reply
app.post('/api/messages', async (req, res) => {
  try {
    const { user_id, message_text } = req.body;
    
    // Save user message
    await db.query(
      'INSERT INTO messages (user_id, message_text, sender) VALUES (?, ?, ?)',
      [user_id, message_text, 'user']
    );
    
    // Generate bot reply
    const botReply = getBotReply(message_text);
    
    // Save bot message
    const [result] = await db.query(
      'INSERT INTO messages (user_id, message_text, sender) VALUES (?, ?, ?)',
      [user_id, botReply, 'bot']
    );
    
    res.json({
      id: result.insertId,
      message_text: botReply,
      sender: 'bot',
      created_at: new Date()
    });
  } catch (error) {
    console.error('Error sending message:', error);
    res.status(500).json({ error: 'Failed to send message' });
  }
});

// 3. Get chat history
app.get('/api/messages/:user_id', async (req, res) => {
  try {
    const { user_id } = req.params;
    const [messages] = await db.query(
      'SELECT * FROM messages WHERE user_id = ? ORDER BY created_at ASC',
      [user_id]
    );
    res.json(messages);
  } catch (error) {
    console.error('Error fetching messages:', error);
    res.status(500).json({ error: 'Failed to fetch messages' });
  }
});

// 4. Submit feedback
app.post('/api/feedback', async (req, res) => {
  try {
    const { user_id, message_id, rating, comment } = req.body;
    await db.query(
      'INSERT INTO feedback (user_id, message_id, rating, comment) VALUES (?, ?, ?, ?)',
      [user_id, message_id, rating, comment || '']
    );
    res.json({ success: true });
  } catch (error) {
    console.error('Error submitting feedback:', error);
    res.status(500).json({ error: 'Failed to submit feedback' });
  }
});

// Start server
app.listen(PORT, () => {
  console.log(`ðŸŒ¾ AgriHelp server running on http://localhost:${PORT}`);
});
```

---
